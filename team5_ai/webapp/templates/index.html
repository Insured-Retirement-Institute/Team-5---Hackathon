<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ATS Portal — Agent Transfer Assistant</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --navy:      #0f2044;
      --navy-mid:  #162d5e;
      --navy-lite: #1e3a73;
      --accent:    #2f80ed;
      --accent-h:  #1a6ed8;
      --sidebar-w: 220px;
      --header-h:  56px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f4f6f9;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      color: #1a1a2e;
    }

    /* ── Top header ────────────────────────────────────────────────── */
    .top-header {
      height: var(--header-h);
      background: var(--navy);
      display: flex;
      align-items: center;
      padding: 0 20px;
      gap: 12px;
      flex-shrink: 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      z-index: 10;
    }

    .logo-mark {
      width: 32px; height: 32px;
      background: var(--accent);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-weight: 800; font-size: 15px; color: #fff;
      letter-spacing: -1px;
      flex-shrink: 0;
    }

    .logo-text {
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.3px;
    }
    .logo-text span { color: #7eb8f7; font-weight: 400; }

    .header-divider { flex: 1; }

    .header-badge {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.15);
      color: #c8d8f0;
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 20px;
    }

    .header-avatar {
      width: 32px; height: 32px;
      border-radius: 50%;
      background: var(--navy-lite);
      border: 2px solid rgba(255,255,255,0.2);
      display: flex; align-items: center; justify-content: center;
      color: #90b8e8; font-size: 13px; font-weight: 600;
    }

    /* ── Body below header ─────────────────────────────────────────── */
    .body-wrap {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* ── Sidebar ───────────────────────────────────────────────────── */
    .sidebar {
      width: var(--sidebar-w);
      background: var(--navy-mid);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      padding: 16px 0;
      overflow-y: auto;
    }

    .nav-section-label {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: #5a7aab;
      padding: 18px 20px 6px;
    }
    .nav-section-label:first-child { padding-top: 4px; }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 11px;
      padding: 9px 20px;
      color: #90afd4;
      font-size: 13.5px;
      cursor: pointer;
      border-left: 3px solid transparent;
      transition: background 0.15s, color 0.15s;
      user-select: none;
    }
    .nav-item:hover {
      background: rgba(255,255,255,0.06);
      color: #dce8f8;
    }
    .nav-item.active {
      background: rgba(47,128,237,0.15);
      border-left-color: var(--accent);
      color: #fff;
    }
    .nav-item svg { flex-shrink: 0; opacity: 0.8; }
    .nav-item.active svg { opacity: 1; }

    .nav-badge {
      margin-left: auto;
      background: var(--accent);
      color: #fff;
      font-size: 10px;
      font-weight: 700;
      padding: 1px 6px;
      border-radius: 10px;
    }

    .sidebar-footer {
      margin-top: auto;
      padding: 16px 20px;
      border-top: 1px solid rgba(255,255,255,0.07);
    }
    .sidebar-user {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #7a9cc4;
      font-size: 12.5px;
    }
    .sidebar-user-avatar {
      width: 28px; height: 28px;
      border-radius: 50%;
      background: var(--navy-lite);
      display: flex; align-items: center; justify-content: center;
      font-size: 11px; font-weight: 700; color: #90b8e8;
      flex-shrink: 0;
    }
    .sidebar-user-name { font-weight: 600; color: #b0c8e8; }
    .sidebar-user-role { font-size: 11px; color: #5a7aab; }

    /* ── Main content ──────────────────────────────────────────────── */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      padding: 24px;
      gap: 16px;
    }

    .page-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .page-title h2 {
      font-size: 18px;
      font-weight: 700;
      color: #0f2044;
    }
    .page-title p {
      font-size: 13px;
      color: #6b7a99;
      margin-top: 2px;
    }

    .status-pills {
      display: flex;
      gap: 8px;
      margin-left: auto;
      align-items: center;
    }
    .pill {
      font-size: 12px;
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 500;
    }
    .pill-green { background: #e6f4ea; color: #1e7e34; }
    .pill-blue  { background: #e8f0fe; color: #1a56c4; }

    /* ── Chat card ─────────────────────────────────────────────────── */
    .chat-card {
      flex: 1;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08), 0 4px 16px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .chat-card-header {
      padding: 14px 20px;
      border-bottom: 1px solid #eef0f4;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .chat-card-header .dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: #34c759;
      box-shadow: 0 0 0 2px #e6f9ec;
    }
    .chat-card-header span {
      font-size: 13.5px;
      font-weight: 600;
      color: #0f2044;
    }
    .chat-card-header small {
      font-size: 12px;
      color: #9aa3b8;
      margin-left: 4px;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .messages::-webkit-scrollbar { width: 4px; }
    .messages::-webkit-scrollbar-thumb { background: #dde1ea; border-radius: 4px; }

    .msg-row {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }
    .msg-row.user { flex-direction: row-reverse; }

    .msg-avatar {
      width: 28px; height: 28px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 11px; font-weight: 700;
      flex-shrink: 0;
    }
    .msg-avatar.agent-av { background: #e8f0fe; color: #1a56c4; }
    .msg-avatar.user-av  { background: #0f2044; color: #90b8e8; }

    .message {
      max-width: 72%;
      padding: 10px 14px;
      border-radius: 16px;
      font-size: 13.5px;
      line-height: 1.55;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .msg-row.agent .message {
      background: #f4f6f9;
      color: #1a1a2e;
      border-bottom-left-radius: 4px;
    }
    .msg-row.user .message {
      background: var(--accent);
      color: #fff;
      border-bottom-right-radius: 4px;
    }
    .msg-row.error .message {
      background: #fff0f0;
      color: #c0392b;
      border-bottom-left-radius: 4px;
    }

    .typing .message {
      background: #f4f6f9;
      color: #9aa3b8;
      font-size: 18px;
      letter-spacing: 3px;
      padding: 8px 16px;
    }

    .input-area {
      display: flex;
      gap: 10px;
      padding: 14px 20px;
      border-top: 1px solid #eef0f4;
    }

    #user-input {
      flex: 1;
      padding: 10px 16px;
      border: 1px solid #dde1ea;
      border-radius: 24px;
      font-size: 13.5px;
      outline: none;
      resize: none;
      font-family: inherit;
      line-height: 1.4;
      max-height: 100px;
      overflow-y: auto;
      background: #f8f9fc;
      color: #1a1a2e;
      transition: border-color 0.15s, background 0.15s;
    }
    #user-input:focus { border-color: var(--accent); background: #fff; }
    #user-input::placeholder { color: #b0b8cc; }

    #send-btn {
      padding: 10px 22px;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 24px;
      font-size: 13.5px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      display: flex; align-items: center; gap: 6px;
      transition: background 0.15s;
    }
    #send-btn:hover    { background: var(--accent-h); }
    #send-btn:disabled { background: #c5cad8; cursor: not-allowed; }
  </style>
</head>
<body>

  <!-- ── Top header ── -->
  <header class="top-header">
    <div class="logo-mark">ATS</div>
    <div class="logo-text">Transfer<span>Portal</span></div>
    <div class="header-divider"></div>
    <div class="header-badge">US-East Region</div>
    <div class="header-avatar">JD</div>
  </header>

  <div class="body-wrap">

    <!-- ── Sidebar ── -->
    <nav class="sidebar">

      <div class="nav-section-label">Main</div>

      <div class="nav-item">
        <!-- Dashboard -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        Dashboard
      </div>

      <div class="nav-item active">
        <!-- AI Assistant -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        AI Assistant
      </div>

      <div class="nav-section-label">Transfers</div>

      <div class="nav-item">
        <!-- New Transfer -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
        New Transfer
      </div>

      <div class="nav-item">
        <!-- All Transfers -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
        All Transfers
        <span class="nav-badge">12</span>
      </div>

      <div class="nav-item">
        <!-- Pending -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        Pending Review
        <span class="nav-badge">3</span>
      </div>

      <div class="nav-section-label">Directory</div>

      <div class="nav-item">
        <!-- Agents -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Agents
      </div>

      <div class="nav-item">
        <!-- IMOs -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
        IMOs
      </div>

      <div class="nav-section-label">Reports</div>

      <div class="nav-item">
        <!-- Analytics -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
        Analytics
      </div>

      <div class="nav-item">
        <!-- Audit Log -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
        Audit Log
      </div>

      <div class="nav-section-label">System</div>

      <div class="nav-item">
        <!-- Settings -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        Settings
      </div>

      <div class="sidebar-footer">
        <div class="sidebar-user">
          <div class="sidebar-user-avatar">JD</div>
          <div>
            <div class="sidebar-user-name">Jane Doe</div>
            <div class="sidebar-user-role">Transfer Admin</div>
          </div>
        </div>
      </div>

    </nav>

    <!-- ── Main content ── -->
    <main class="main">

      <div class="page-title">
        <div>
          <h2>AI Transfer Assistant</h2>
          <p>Chat with the assistant to create and manage agent transfers</p>
        </div>
        <div class="status-pills">
          <span class="pill pill-green">● Agent Online</span>
          <span class="pill pill-blue">ATS API Connected</span>
        </div>
      </div>

      <div class="chat-card">
        <div class="chat-card-header">
          <div class="dot"></div>
          <span>Transfer Assistant</span>
          <small>Powered by Amazon Bedrock</small>
        </div>

        <div class="messages" id="messages">
          <div class="msg-row agent">
            <div class="msg-avatar agent-av">AI</div>
            <div class="message">Hi! I can help you create, view, and manage agent transfers between IMOs. What would you like to do today?</div>
          </div>
        </div>

        <div class="input-area">
          <textarea id="user-input" rows="1" placeholder="Ask me to create a transfer, check status, or cancel a request…"></textarea>
          <button id="send-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            Send
          </button>
        </div>
      </div>

    </main>
  </div>

  <script>
    const messagesEl = document.getElementById('messages');
    const inputEl    = document.getElementById('user-input');
    const sendBtn    = document.getElementById('send-btn');

    function scrollToBottom() {
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function addMessage(text, role) {
      const row = document.createElement('div');
      row.className = `msg-row ${role}`;

      if (role !== 'user') {
        const av = document.createElement('div');
        av.className = 'msg-avatar agent-av';
        av.textContent = role === 'error' ? '!' : 'AI';
        row.appendChild(av);
      }

      const bubble = document.createElement('div');
      bubble.className = 'message';
      bubble.textContent = text;
      row.appendChild(bubble);

      if (role === 'user') {
        const av = document.createElement('div');
        av.className = 'msg-avatar user-av';
        av.textContent = 'JD';
        row.appendChild(av);
      }

      messagesEl.appendChild(row);
      scrollToBottom();
      return row;
    }

    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;

      inputEl.value = '';
      inputEl.style.height = 'auto';
      sendBtn.disabled = true;
      addMessage(text, 'user');

      const typingRow = document.createElement('div');
      typingRow.className = 'msg-row agent typing';
      const typingAv = document.createElement('div');
      typingAv.className = 'msg-avatar agent-av';
      typingAv.textContent = 'AI';
      const typingBubble = document.createElement('div');
      typingBubble.className = 'message';
      typingBubble.textContent = '···';
      typingRow.appendChild(typingAv);
      typingRow.appendChild(typingBubble);
      messagesEl.appendChild(typingRow);
      scrollToBottom();

      try {
        const res = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: text }),
        });
        const data = await res.json();
        messagesEl.removeChild(typingRow);
        addMessage(data.error ? 'Error: ' + data.error : data.reply, data.error ? 'error' : 'agent');
      } catch (err) {
        messagesEl.removeChild(typingRow);
        addMessage('Network error — please try again.', 'error');
      } finally {
        sendBtn.disabled = false;
        inputEl.focus();
      }
    }

    sendBtn.addEventListener('click', sendMessage);
    inputEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
    });
    inputEl.addEventListener('input', () => {
      inputEl.style.height = 'auto';
      inputEl.style.height = inputEl.scrollHeight + 'px';
    });
  </script>
</body>
</html>
